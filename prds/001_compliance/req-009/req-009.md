# **Technical Implementation Details: REQ-009**

## **Requirement: Install Core Dependencies**

> **User Story:** As a developer, I want the core packages (`laravel-debugbar`, `laravel-ide-helper`, `laravel-permission`, `laravel-data`, `dedoc/scramble`) installed so that common problems like permissions and DTOs are handled by standard libraries.

---

### **Objective**

To install and configure the curated set of essential third-party packages as defined in the project standards. These packages provide critical functionality for debugging, IDE support, access control, data handling, and API documentation.

### **Implementation Steps**

1.  **Install `require-dev` Packages:**
    *   These packages are only needed for local development and should not be installed in production.
    *   **`barryvdh/laravel-debugbar`:** Provides an indispensable in-browser debugging toolbar.
    *   **`barryvdh/laravel-ide-helper`:** Generates helper files to improve IDE autocompletion and static analysis accuracy.
    *   **`dedoc/scramble`:** Automatically generates OpenAPI (Swagger) documentation for your API.
    *   **Command:**
        ```bash
        composer require --dev barryvdh/laravel-debugbar barryvdh/laravel-ide-helper dedoc/scramble
        ```

2.  **Install `require` Packages:**
    *   These packages are required for the application to function and will be installed in all environments, including production.
    *   **`spatie/laravel-permission`:** A flexible and powerful package for managing roles and permissions (Role-Based Access Control).
    *   **`spatie/laravel-data`:** A best-in-class library for creating Data Transfer Objects (DTOs) and Value Objects.
    *   **Command:**
        ```bash
        composer require spatie/laravel-permission spatie/laravel-data
        ```

3.  **Publish Package Assets and Configuration:**
    *   Some packages require their configuration files or database migrations to be published to the application's local directories.
    *   **`laravel-permission`:**
        ```bash
        php artisan vendor:publish --provider="Spatie\Permission\PermissionServiceProvider"
        ```
    *   **`laravel-data` (optional, if you need to customize config):**
        ```bash
        php artisan vendor:publish --tag=data-config
        ```
    *   **`scramble` (optional, if you need to customize config):**
        ```bash
        php artisan vendor:publish --tag=scramble-config
        ```

4.  **Run Database Migrations:**
    *   The `spatie/laravel-permission` package includes migrations to create the necessary `roles`, `permissions`, `model_has_roles`, etc., tables. Run the `migrate` command to add these to your database.
    *   **Command:**
        ```bash
        php artisan migrate
        ```

5.  **Configure `laravel-permission`:**
    *   To enable role/permission checking, add the `HasRoles` trait to your `User` model.
    *   **File:** `app/Models/User.php`
    ```php
    <?php

    namespace App\Models;

    use Illuminate\Foundation\Auth\User as Authenticatable;
    use Spatie\Permission\Traits\HasRoles; // Import the trait

    class User extends Authenticatable
    {
        use HasRoles; // Use the trait

        // ... rest of the model
    }
    ```

6.  **Generate IDE Helper Files:**
    *   After all packages are installed and configured, run the `laravel-ide-helper` commands to generate accurate helper files based on the final application state.
    *   **Commands:**
        ```bash
        php artisan ide-helper:generate
        php artisan ide-helper:models --write-mixin
        php artisan ide-helper:meta
        ```
    *   It is recommended to add these files to your `.gitignore` file to avoid committing them to version control, as they are specific to the local environment.

### **Verification**

1.  All listed packages are present in the `composer.json` file in the correct sections (`require` or `require-dev`).
2.  The `config/permission.php` file exists.
3.  The `roles`, `permissions`, and related tables exist in the database after running migrations.
4.  The `User` model has the `HasRoles` trait.
5.  When running the application in a browser with `APP_DEBUG=true`, the Laravel Debugbar appears at the bottom of the page.
6.  The IDE helper files (`_ide_helper.php`, `.phpstorm.meta.php`, etc.) are generated in the project root.
7.  The application's API documentation is available at the `/docs/api` endpoint (default for Scramble).

### **Risks and Mitigation**

*   **Risk:** A newly installed package conflicts with an existing dependency.
    *   **Mitigation:** Composer's dependency resolver will typically catch these issues during installation. If a conflict occurs, it may be necessary to find a different version of the package or an alternative package that is compatible with the rest of the stack.
